#!/usr/bin/env node

'use strict';

var Version = require('../lib/version');
var Commander = require('commander');
var Dependo = require('../lib/dependo');
var fs = require('fs');

Commander
    .version(Version)
    .usage('[options] <file|dir ...>')
    .option('-f, --format <name>', 'format to parse (amd/cjs/es6/json)', 'amd')
    .option('-x, --exclude <regex>', 'a regular expression for excluding modules')
    .option('-d, --deps <filename>', 'when used with \'-f json\', a file to load deps from in {p1:[\'c1\',\'c2\']} format')
    .parse(process.argv);


if (Commander.format !== "json" && !Commander.args.length) {
  console.log(Commander.helpInformation());
  process.exit(1);
}

var src = Commander.args[0];

var directDeps = Commander.format==='json' &&
  fs.existsSync(Commander.deps) &&
  JSON.parse(fs.readFileSync(Commander.deps));

var dependo = new Dependo(src, {
    format: Commander.format,
    exclude: Commander.exclude,
    directDeps: directDeps
});

var html = dependo.generateHtml();

process.stdout.write(html);
